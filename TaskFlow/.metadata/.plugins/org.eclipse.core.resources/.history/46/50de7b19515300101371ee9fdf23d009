package com.taskflow.app;

import com.taskflow.model.Category;
import com.taskflow.model.RootGroup;
import com.taskflow.persistence.XmlSaxHandler;
import com.taskflow.ui.MainFrame;
import com.taskflow.util.PropertiesManager;

import javax.swing.*;
import java.io.File;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

/**
 * Entry point for the TaskFlow application.
 */
public class TaskFlowApp {
    public static void main(String[] args) {
        // Setup Look and Feel
        try {
            String lafClass = PropertiesManager.get("ui.lookAndFeel",
                    UIManager.getSystemLookAndFeelClassName());
            UIManager.setLookAndFeel(lafClass);
        } catch (Exception e) {
            System.err.println("Failed to set Look & Feel: " + e.getMessage());
        }

        // Load initial categories
        List<Category> categories;
        String dataFilePath = PropertiesManager.get("data.file", "data.xml");
        File dataFile = new File(dataFilePath);
        if (dataFile.exists()) {
        		try {
        			loader = new XmlSaxHandler();
        			categories = loader.load(dataFile);
            } catch (Exception e) {
                System.err.println("Failed to load data: " + e.getMessage());
                categories = Collections.emptyList();
            }
        } else {
            categories = Collections.emptyList();
        }

        // Wrap categories in a default RootGroup
        RootGroup defaultRoot = new RootGroup("Default", "#000000");
        defaultRoot.getCategories().addAll(categories);
        List<RootGroup> initRoots = new ArrayList<>();
        initRoots.add(defaultRoot);

        // Launch UI
        SwingUtilities.invokeLater(() -> {
            MainFrame frame = new MainFrame(initRoots);
            frame.setVisible(true);
        });
    }
}
