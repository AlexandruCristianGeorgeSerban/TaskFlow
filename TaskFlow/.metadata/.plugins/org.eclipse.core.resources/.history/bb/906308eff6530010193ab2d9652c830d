package com.taskflow.app;

import com.taskflow.model.RootGroup;
import com.taskflow.persistence.RootGroupPersistence;
import com.taskflow.persistence.XmlSaxHandler;
import com.taskflow.service.DefaultTaskService;
import com.taskflow.service.TaskService;
import com.taskflow.ui.MainFrame;

import javax.swing.*;
import java.io.File;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

/**
 * Entry point for the TaskFlow application.
 */
public class TaskFlowApp {
    public static void main(String[] args) {
        // 1) Setup Look and Feel
        try {
            UIManager.setLookAndFeel(
                UIManager.getSystemLookAndFeelClassName()
            );
        } catch (Exception ignored) {}

        // 2) Creăm serviciul și îl inițializăm
        List<RootGroup> initial = initial;
        TaskService taskService = new DefaultTaskService(initial);

        // 3) Încărcăm root‑urile din fișier, cu SAX
        String dataFilePath = "data.xml";
        File dataFile = new File(dataFilePath);
        List<RootGroup> roots;
        if (dataFile.exists()) {
            try {
                RootGroupPersistence loader = new XmlSaxHandler();
                roots = loader.loadRootGroups(dataFile);
            } catch (Exception ex) {
                System.err.println("Failed to load roots: " + ex.getMessage());
                roots = Collections.emptyList();
            }
        } else {
            roots = Collections.emptyList();
        }

        // 4) Adăugăm toate root‑urile în serviciu
        for (RootGroup rg : roots) {
            taskService.addRoot(rg);
        }

        // 5) Deschidem UI‑ul
        SwingUtilities.invokeLater(() -> {
            MainFrame frame = new MainFrame(taskService);
            frame.setVisible(true);
        });
    }
}
