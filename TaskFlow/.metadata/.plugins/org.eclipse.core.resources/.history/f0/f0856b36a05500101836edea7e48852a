package com.taskflow.service;

import com.taskflow.model.RootGroup;
import com.taskflow.model.Category;
import com.taskflow.model.Task;

import java.util.ArrayList;
import java.util.List;

/**
 * Implementare de bază a TaskService, folosind liste în memorie.
 */
public class DefaultTaskService implements TaskService {
    private final List<RootGroup> roots;

    /** Constructor implicit — începe cu lista goală. */
    public DefaultTaskService() {
        this.roots = new ArrayList<>();
    }
    
    /** 
     * Constructor: primește lista inițială de root-uri (poate fi goală). 
     */
    public DefaultTaskService(List<RootGroup> initialRoots) {
        this.roots = new ArrayList<>(initialRoots);
    }

    @Override
    public List<RootGroup> getAllRoots() {
    	return roots;
    }

    @Override
    public void addRoot(RootGroup root) {
        roots.add(root);
    }
    
    @Override
    public void insertRoot(int index, RootGroup root) {
        // limitează index-ul între 0 și mărimea listei
        if (index < 0) index = 0;
        if (index > roots.size()) index = roots.size();
        roots.add(index, root);
    }

    @Override
    public void updateRoot(RootGroup root) {
        // presupunem că obiectul root a fost deja modificat în parametru
        // nu trebuie altceva, lista conține referința
    }

    @Override
    public void addCategory(RootGroup root, Category category) {
        root.getCategories().add(category);
    }

    @Override
    public void updateCategory(Category category) {
        // idem: categoria modificată deja prin referință
    }

    @Override
    public void addTask(Category category, Task task) {
        category.getTasks().add(task);
    }

    @Override
    public void updateTask(Task task) {
        // idem
    }
    
    @Override
    public void removeRoot(RootGroup root) {
        roots.remove(root);
    }

    @Override
    public void removeCategory(RootGroup parent, Category cat) {
        parent.getCategories().remove(cat);
    }

    @Override
    public void removeTask(Category parent, Task t) {
        parent.getTasks().remove(t);
    }
    
    @Override
    public void moveRoot(RootGroup root, int toIndex) {
        int from = roots.indexOf(root);
        if (from == -1) return;          // dacă nu există, ignore
        // normalizează toIndex
        if (toIndex < 0) toIndex = 0;
        if (toIndex > roots.size()-1) toIndex = roots.size()-1;
        // mută elementul
        roots.remove(from);
        roots.add(toIndex, root);
    }
}
